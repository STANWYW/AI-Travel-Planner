# å•å®¹å™¨ Docker éƒ¨ç½²æŒ‡å—

## ðŸŽ¯ éƒ¨ç½²æž¶æž„

æœ¬é¡¹ç›®é‡‡ç”¨**å•å®¹å™¨éƒ¨ç½²**æ–¹å¼ï¼Œå‰åŽç«¯æ‰“åŒ…åœ¨ä¸€ä¸ª Docker å®¹å™¨ä¸­ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   travel-planner-app (å®¹å™¨)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Nginx   â”‚  â”‚  Node.js    â”‚  â”‚
â”‚  â”‚  (å‰ç«¯)  â”‚  â”‚  (åŽç«¯ API) â”‚  â”‚
â”‚  â”‚  :80     â”‚  â”‚  :3000      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚               â”‚         â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚               â”‚                 â”‚
â”‚        åå‘ä»£ç† /api            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               â”‚                 â”‚
â”‚   postgres (æ•°æ®åº“å®¹å™¨)          â”‚
â”‚   :5432                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/STANWYW/AI-Travel-Planner.git
cd AI-Travel-Planner
```

### 2. å¯åŠ¨æœåŠ¡
```bash
docker-compose up -d --build
```

### 3. è®¿é—®åº”ç”¨
- **å‰ç«¯**: http://localhost
- **åŽç«¯ API**: http://localhost/api
- **å¥åº·æ£€æŸ¥**: http://localhost/health

## ðŸ“¦ Docker é•œåƒè¯´æ˜Ž

### æž„å»ºè¿‡ç¨‹

1. **é˜¶æ®µ 1: åŽç«¯æž„å»º**
   - ä½¿ç”¨ `node:20-slim`
   - å®‰è£…ä¾èµ–ã€ç¼–è¯‘ TypeScript
   - ç”Ÿæˆ Prisma å®¢æˆ·ç«¯

2. **é˜¶æ®µ 2: å‰ç«¯æž„å»º**
   - ä½¿ç”¨ `node:20-alpine`
   - å®‰è£…ä¾èµ–ã€æž„å»º React åº”ç”¨
   - ç”Ÿæˆé™æ€æ–‡ä»¶

3. **é˜¶æ®µ 3: ç”Ÿäº§é•œåƒ**
   - ä½¿ç”¨ `node:20-slim`
   - å®‰è£… Nginx
   - å¤åˆ¶æž„å»ºäº§ç‰©
   - é…ç½®å¯åŠ¨è„šæœ¬

### é•œåƒå¤§å°

- **æœ€ç»ˆé•œåƒ**: çº¦ 700-800 MB
- **åŒ…å«**: Node.jsã€Nginxã€å‰åŽç«¯ä»£ç 

## ðŸ”§ é…ç½®è¯´æ˜Ž

### çŽ¯å¢ƒå˜é‡

åœ¨ `docker-compose.yml` ä¸­é…ç½®ï¼š

```yaml
environment:
  # æ•°æ®åº“é…ç½®
  POSTGRES_HOST: postgres
  POSTGRES_USER: postgres
  POSTGRES_PASSWORD: postgres
  POSTGRES_DB: travel_planner
  
  # åŽç«¯é…ç½®
  JWT_SECRET: your-secret-key
  JWT_EXPIRES_IN: 7d
  PORT: 3000
  NODE_ENV: production
```

### Nginx é…ç½®

`nginx.conf` é…ç½®äº†ï¼š
- å‰ç«¯é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆ`/`ï¼‰
- åŽç«¯ API ä»£ç†ï¼ˆ`/api`ï¼‰
- å¥åº·æ£€æŸ¥ä»£ç†ï¼ˆ`/health`ï¼‰

## ðŸ“ å¯åŠ¨æµç¨‹

å®¹å™¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š

1. **ç­‰å¾…æ•°æ®åº“å°±ç»ª**ï¼ˆå¥åº·æ£€æŸ¥ï¼‰
2. **è¿è¡Œæ•°æ®åº“è¿ç§»**ï¼ˆPrisma migrate deployï¼‰
3. **å¯åŠ¨åŽç«¯æœåŠ¡**ï¼ˆNode.jsï¼ŒåŽå°è¿è¡Œï¼‰
4. **å¯åŠ¨ Nginx**ï¼ˆå‰å°è¿è¡Œï¼Œä¿æŒå®¹å™¨è¿è¡Œï¼‰

## ðŸ§ª æµ‹è¯•éƒ¨ç½²

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
```bash
docker-compose ps
```

åº”è¯¥çœ‹åˆ°ï¼š
- `travel-planner-db` - æ•°æ®åº“ï¼ˆhealthyï¼‰
- `travel-planner-app` - åº”ç”¨å®¹å™¨ï¼ˆrunningï¼‰

### 2. æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f app

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs -f postgres
```

### 3. æµ‹è¯• API
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost/health

# æ³¨å†Œç”¨æˆ·
curl -X POST http://localhost/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "username": "testuser",
    "password": "password123"
  }'
```

## ðŸ” æ•…éšœæŽ’æŸ¥

### é—®é¢˜ 1: å®¹å™¨æ— æ³•å¯åŠ¨

**æ£€æŸ¥æ—¥å¿—**ï¼š
```bash
docker-compose logs app
```

**å¸¸è§åŽŸå› **ï¼š
- æ•°æ®åº“æœªå°±ç»ªï¼ˆç­‰å¾…æ—¶é—´ä¸å¤Ÿï¼‰
- ç«¯å£è¢«å ç”¨ï¼ˆ80 ç«¯å£ï¼‰
- çŽ¯å¢ƒå˜é‡é…ç½®é”™è¯¯

### é—®é¢˜ 2: å‰ç«¯æ— æ³•è®¿é—®åŽç«¯

**æ£€æŸ¥ Nginx é…ç½®**ï¼š
```bash
docker-compose exec app cat /etc/nginx/sites-available/default
```

**æ£€æŸ¥åŽç«¯æ˜¯å¦è¿è¡Œ**ï¼š
```bash
docker-compose exec app ps aux | grep node
```

### é—®é¢˜ 3: æ•°æ®åº“è¿žæŽ¥å¤±è´¥

**æ£€æŸ¥æ•°æ®åº“å®¹å™¨**ï¼š
```bash
docker-compose ps postgres
docker-compose logs postgres
```

**æ‰‹åŠ¨æµ‹è¯•è¿žæŽ¥**ï¼š
```bash
docker-compose exec app psql -h postgres -U postgres -d travel_planner -c "SELECT 1"
```

## ðŸ“Š æ€§èƒ½ä¼˜åŒ–

### æž„å»ºä¼˜åŒ–

- âœ… å¤šé˜¶æ®µæž„å»ºå‡å°‘é•œåƒå¤§å°
- âœ… ä½¿ç”¨ `.dockerignore` æŽ’é™¤ä¸å¿…è¦æ–‡ä»¶
- âœ… ç¼“å­˜ npm ä¾èµ–å±‚

### è¿è¡Œæ—¶ä¼˜åŒ–

- âœ… Nginx é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆé«˜æ•ˆï¼‰
- âœ… Node.js åŽç«¯ç‹¬ç«‹è¿›ç¨‹
- âœ… æ•°æ®åº“è¿žæŽ¥æ± ï¼ˆPrismaï¼‰

## ðŸ”„ æ›´æ–°éƒ¨ç½²

### æ›´æ–°ä»£ç 
```bash
git pull
docker-compose build --no-cache app
docker-compose up -d
```

### ä»…æ›´æ–°å‰ç«¯
```bash
# ä¿®æ”¹å‰ç«¯ä»£ç åŽ
docker-compose build --no-cache app
docker-compose restart app
```

### ä»…æ›´æ–°åŽç«¯
```bash
# ä¿®æ”¹åŽç«¯ä»£ç åŽ
docker-compose build --no-cache app
docker-compose restart app
```

## ðŸŽ¯ ä¼˜åŠ¿

### å•å®¹å™¨éƒ¨ç½²çš„ä¼˜åŠ¿

1. **ç®€åŒ–éƒ¨ç½²**
   - åªéœ€ä¸€ä¸ªå®¹å™¨
   - å‡å°‘ç½‘ç»œé…ç½®
   - ç»Ÿä¸€æ—¥å¿—ç®¡ç†

2. **èµ„æºæ•ˆçŽ‡**
   - å…±äº«åŸºç¡€é•œåƒ
   - å‡å°‘å†…å­˜å ç”¨
   - é™ä½Žå¯åŠ¨æ—¶é—´

3. **æ˜“äºŽç®¡ç†**
   - å•ä¸€å…¥å£ç‚¹
   - ç»Ÿä¸€çŽ¯å¢ƒå˜é‡
   - ç®€åŒ–ç›‘æŽ§

### ä¸Žä¼ ç»Ÿå¤šå®¹å™¨å¯¹æ¯”

| ç‰¹æ€§ | å•å®¹å™¨ | å¤šå®¹å™¨ |
|------|--------|--------|
| å®¹å™¨æ•°é‡ | 1 | 2-3 |
| ç½‘ç»œé…ç½® | ç®€å• | å¤æ‚ |
| æ—¥å¿—ç®¡ç† | ç»Ÿä¸€ | åˆ†æ•£ |
| èµ„æºå ç”¨ | è¾ƒä½Ž | è¾ƒé«˜ |
| æ‰©å±•æ€§ | ä¸­ç­‰ | é«˜ |

## ðŸ“ æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§çŽ¯å¢ƒå»ºè®®**ï¼š
   - ä½¿ç”¨ HTTPSï¼ˆé…ç½® SSL è¯ä¹¦ï¼‰
   - è®¾ç½®å¼º JWT_SECRET
   - é…ç½®æ•°æ®åº“å¤‡ä»½
   - ä½¿ç”¨çŽ¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆ`.env`ï¼‰

2. **å®‰å…¨å»ºè®®**ï¼š
   - ä¸è¦æš´éœ²æ•°æ®åº“ç«¯å£
   - ä½¿ç”¨é˜²ç«å¢™è§„åˆ™
   - å®šæœŸæ›´æ–°ä¾èµ–

3. **ç›‘æŽ§å»ºè®®**ï¼š
   - ç›‘æŽ§å®¹å™¨èµ„æºä½¿ç”¨
   - è®¾ç½®æ—¥å¿—è½®è½¬
   - é…ç½®å¥åº·æ£€æŸ¥å‘Šè­¦

## ðŸš€ ç”Ÿäº§éƒ¨ç½²ç¤ºä¾‹

```bash
# 1. è®¾ç½®çŽ¯å¢ƒå˜é‡
export JWT_SECRET=$(openssl rand -base64 32)
export POSTGRES_PASSWORD=$(openssl rand -base64 16)

# 2. åˆ›å»º .env æ–‡ä»¶
cat > .env << EOF
JWT_SECRET=$JWT_SECRET
POSTGRES_PASSWORD=$POSTGRES_PASSWORD
EOF

# 3. å¯åŠ¨æœåŠ¡
docker-compose up -d --build

# 4. éªŒè¯
curl http://localhost/health
```

---

**å•å®¹å™¨éƒ¨ç½²å·²å®Œæˆï¼** ðŸŽ‰

çŽ°åœ¨æ‚¨å¯ä»¥é€šè¿‡ `docker-compose up -d` ä¸€é”®å¯åŠ¨æ•´ä¸ªåº”ç”¨ï¼

